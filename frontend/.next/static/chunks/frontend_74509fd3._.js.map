{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///E:/zama4/time-quill-vault/frontend/fhevm/internal/constants.ts"],"sourcesContent":["export const SDK_CDN_URL =\r\n  \"https://cdn.zama.ai/relayer-sdk-js/0.2.0/relayer-sdk-js.umd.cjs\";\r\n\r\n"],"names":[],"mappings":";;;;AAAO,MAAM,cACX","debugId":null}},
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///E:/zama4/time-quill-vault/frontend/fhevm/internal/RelayerSDKLoader.ts"],"sourcesContent":["import { FhevmRelayerSDKType, FhevmWindowType } from \"./fhevmTypes\";\r\nimport { SDK_CDN_URL } from \"./constants\";\r\n\r\ntype TraceType = (message?: unknown, ...optionalParams: unknown[]) => void;\r\n\r\nexport class RelayerSDKLoader {\r\n  private _trace?: TraceType;\r\n\r\n  constructor(options: { trace?: TraceType }) {\r\n    this._trace = options.trace;\r\n  }\r\n\r\n  public isLoaded() {\r\n    if (typeof window === \"undefined\") {\r\n      throw new Error(\"RelayerSDKLoader: can only be used in the browser.\");\r\n    }\r\n    return isFhevmWindowType(window, this._trace);\r\n  }\r\n\r\n  public load(): Promise<void> {\r\n    console.log(\"[RelayerSDKLoader] load...\");\r\n    // Ensure this only runs in the browser\r\n    if (typeof window === \"undefined\") {\r\n      console.log(\"[RelayerSDKLoader] window === undefined\");\r\n      return Promise.reject(\r\n        new Error(\"RelayerSDKLoader: can only be used in the browser.\")\r\n      );\r\n    }\r\n\r\n    if (\"relayerSDK\" in window) {\r\n      if (!isFhevmRelayerSDKType(window.relayerSDK, this._trace)) {\r\n        console.log(\"[RelayerSDKLoader] window.relayerSDK === undefined\");\r\n        throw new Error(\"RelayerSDKLoader: Unable to load FHEVM Relayer SDK\");\r\n      }\r\n      return Promise.resolve();\r\n    }\r\n\r\n    return new Promise((resolve, reject) => {\r\n      const existingScript = document.querySelector(\r\n        `script[src=\"${SDK_CDN_URL}\"]`\r\n      );\r\n      if (existingScript) {\r\n        if (!isFhevmWindowType(window, this._trace)) {\r\n          reject(\r\n            new Error(\r\n              \"RelayerSDKLoader: window object does not contain a valid relayerSDK object.\"\r\n            )\r\n          );\r\n        }\r\n        resolve();\r\n        return;\r\n      }\r\n\r\n      const script = document.createElement(\"script\");\r\n      script.src = SDK_CDN_URL;\r\n      script.type = \"text/javascript\";\r\n      script.async = true;\r\n\r\n      script.onload = () => {\r\n        if (!isFhevmWindowType(window, this._trace)) {\r\n          console.log(\"[RelayerSDKLoader] script onload FAILED...\");\r\n          reject(\r\n            new Error(\r\n              `RelayerSDKLoader: Relayer SDK script has been successfully loaded from ${SDK_CDN_URL}, however, the window.relayerSDK object is invalid.`\r\n            )\r\n          );\r\n        }\r\n        resolve();\r\n      };\r\n\r\n      script.onerror = () => {\r\n        console.log(\"[RelayerSDKLoader] script onerror... \");\r\n        reject(\r\n          new Error(\r\n            `RelayerSDKLoader: Failed to load Relayer SDK from ${SDK_CDN_URL}`\r\n          )\r\n        );\r\n      };\r\n\r\n      console.log(\"[RelayerSDKLoader] add script to DOM...\");\r\n      document.head.appendChild(script);\r\n      console.log(\"[RelayerSDKLoader] script added!\")\r\n    });\r\n  }\r\n}\r\n\r\nfunction isFhevmRelayerSDKType(\r\n  o: unknown,\r\n  trace?: TraceType\r\n): o is FhevmRelayerSDKType {\r\n  if (typeof o === \"undefined\") {\r\n    trace?.(\"RelayerSDKLoader: relayerSDK is undefined\");\r\n    return false;\r\n  }\r\n  if (o === null) {\r\n    trace?.(\"RelayerSDKLoader: relayerSDK is null\");\r\n    return false;\r\n  }\r\n  if (typeof o !== \"object\") {\r\n    trace?.(\"RelayerSDKLoader: relayerSDK is not an object\");\r\n    return false;\r\n  }\r\n  if (!objHasProperty(o, \"initSDK\", \"function\", trace)) {\r\n    trace?.(\"RelayerSDKLoader: relayerSDK.initSDK is invalid\");\r\n    return false;\r\n  }\r\n  if (!objHasProperty(o, \"createInstance\", \"function\", trace)) {\r\n    trace?.(\"RelayerSDKLoader: relayerSDK.createInstance is invalid\");\r\n    return false;\r\n  }\r\n  if (!objHasProperty(o, \"SepoliaConfig\", \"object\", trace)) {\r\n    trace?.(\"RelayerSDKLoader: relayerSDK.SepoliaConfig is invalid\");\r\n    return false;\r\n  }\r\n  if (\"__initialized__\" in o) {\r\n    if (o.__initialized__ !== true && o.__initialized__ !== false) {\r\n      trace?.(\"RelayerSDKLoader: relayerSDK.__initialized__ is invalid\");\r\n      return false;\r\n    }\r\n  }\r\n  return true;\r\n}\r\n\r\nexport function isFhevmWindowType(\r\n  win: unknown,\r\n  trace?: TraceType\r\n): win is FhevmWindowType {\r\n  if (typeof win === \"undefined\") {\r\n    trace?.(\"RelayerSDKLoader: window object is undefined\");\r\n    return false;\r\n  }\r\n  if (win === null) {\r\n    trace?.(\"RelayerSDKLoader: window object is null\");\r\n    return false;\r\n  }\r\n  if (typeof win !== \"object\") {\r\n    trace?.(\"RelayerSDKLoader: window is not an object\");\r\n    return false;\r\n  }\r\n  if (!(\"relayerSDK\" in win)) {\r\n    trace?.(\"RelayerSDKLoader: window does not contain 'relayerSDK' property\");\r\n    return false;\r\n  }\r\n  return isFhevmRelayerSDKType(win.relayerSDK);\r\n}\r\n\r\nfunction objHasProperty<\r\n  T extends object,\r\n  K extends PropertyKey,\r\n  V extends string // \"string\", \"number\", etc.\r\n>(\r\n  obj: T,\r\n  propertyName: K,\r\n  propertyType: V,\r\n  trace?: TraceType\r\n): obj is T &\r\n  Record<\r\n    K,\r\n    V extends \"string\"\r\n      ? string\r\n      : V extends \"number\"\r\n      ? number\r\n      : V extends \"object\"\r\n      ? object\r\n      : V extends \"boolean\"\r\n      ? boolean\r\n      : V extends \"function\"\r\n      ? // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n        (...args: any[]) => any\r\n      : unknown\r\n  > {\r\n  if (!obj || typeof obj !== \"object\") {\r\n    return false;\r\n  }\r\n\r\n  if (!(propertyName in obj)) {\r\n    trace?.(`RelayerSDKLoader: missing ${String(propertyName)}.`);\r\n    return false;\r\n  }\r\n\r\n  const value = (obj as Record<K, unknown>)[propertyName];\r\n\r\n  if (value === null || value === undefined) {\r\n    trace?.(`RelayerSDKLoader: ${String(propertyName)} is null or undefined.`);\r\n    return false;\r\n  }\r\n\r\n  if (typeof value !== propertyType) {\r\n    trace?.(\r\n      `RelayerSDKLoader: ${String(propertyName)} is not a ${propertyType}.`\r\n    );\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 156, "column": 0}, "map": {"version":3,"sources":["file:///E:/zama4/time-quill-vault/frontend/fhevm/internal/PublicKeyStorage.ts"],"sourcesContent":["import { openDB, DBSchema, IDBPDatabase } from \"idb\";\r\n\r\ntype FhevmStoredPublicKey = {\r\n  publicKeyId: string;\r\n  publicKey: Uint8Array;\r\n};\r\n\r\ntype FhevmStoredPublicParams = {\r\n  publicParamsId: string;\r\n  publicParams: Uint8Array;\r\n};\r\n\r\ninterface PublicParamsDB extends DBSchema {\r\n  publicKeyStore: {\r\n    key: string;\r\n    value: {\r\n      acl: `0x${string}`;\r\n      value: FhevmStoredPublicKey;\r\n    };\r\n  };\r\n  paramsStore: {\r\n    key: string;\r\n    value: {\r\n      acl: `0x${string}`;\r\n      value: FhevmStoredPublicParams;\r\n    };\r\n  };\r\n}\r\n\r\nlet __dbPromise: Promise<IDBPDatabase<PublicParamsDB>> | undefined = undefined;\r\n\r\nasync function _getDB(): Promise<IDBPDatabase<PublicParamsDB> | undefined> {\r\n  if (__dbPromise) {\r\n    return __dbPromise;\r\n  }\r\n  if (typeof window === \"undefined\") {\r\n    return undefined;\r\n  }\r\n  __dbPromise = openDB<PublicParamsDB>(\"fhevm\", 1, {\r\n    upgrade(db) {\r\n      if (!db.objectStoreNames.contains(\"paramsStore\")) {\r\n        db.createObjectStore(\"paramsStore\", { keyPath: \"acl\" });\r\n      }\r\n      if (!db.objectStoreNames.contains(\"publicKeyStore\")) {\r\n        db.createObjectStore(\"publicKeyStore\", { keyPath: \"acl\" });\r\n      }\r\n    },\r\n  });\r\n  return __dbPromise;\r\n}\r\n\r\ntype FhevmInstanceConfigPublicKey = {\r\n  data: Uint8Array | null;\r\n  id: string | null;\r\n};\r\n\r\ntype FhevmInstanceConfigPublicParams = {\r\n  \"2048\": {\r\n    publicParamsId: string;\r\n    publicParams: Uint8Array;\r\n  };\r\n};\r\n\r\nfunction assertFhevmStoredPublicKey(\r\n  value: unknown\r\n): asserts value is FhevmStoredPublicKey | null {\r\n  if (typeof value !== \"object\") {\r\n    throw new Error(`FhevmStoredPublicKey must be an object`);\r\n  }\r\n  if (value === null) {\r\n    return;\r\n  }\r\n  if (!(\"publicKeyId\" in value)) {\r\n    throw new Error(`FhevmStoredPublicKey.publicKeyId does not exist`);\r\n  }\r\n  if (typeof value.publicKeyId !== \"string\") {\r\n    throw new Error(`FhevmStoredPublicKey.publicKeyId must be a string`);\r\n  }\r\n  if (!(\"publicKey\" in value)) {\r\n    throw new Error(`FhevmStoredPublicKey.publicKey does not exist`);\r\n  }\r\n  if (!(value.publicKey instanceof Uint8Array)) {\r\n    throw new Error(`FhevmStoredPublicKey.publicKey must be a Uint8Array`);\r\n  }\r\n}\r\n\r\nfunction assertFhevmStoredPublicParams(\r\n  value: unknown\r\n): asserts value is FhevmStoredPublicParams | null {\r\n  if (typeof value !== \"object\") {\r\n    throw new Error(`FhevmStoredPublicParams must be an object`);\r\n  }\r\n  if (value === null) {\r\n    return;\r\n  }\r\n  if (!(\"publicParamsId\" in value)) {\r\n    throw new Error(`FhevmStoredPublicParams.publicParamsId does not exist`);\r\n  }\r\n  if (typeof value.publicParamsId !== \"string\") {\r\n    throw new Error(`FhevmStoredPublicParams.publicParamsId must be a string`);\r\n  }\r\n  if (!(\"publicParams\" in value)) {\r\n    throw new Error(`FhevmStoredPublicParams.publicParams does not exist`);\r\n  }\r\n  if (!(value.publicParams instanceof Uint8Array)) {\r\n    throw new Error(\r\n      `FhevmStoredPublicParams.publicParams must be a Uint8Array`\r\n    );\r\n  }\r\n}\r\n\r\nexport async function publicKeyStorageGet(aclAddress: `0x${string}`): Promise<{\r\n  publicKey?: FhevmInstanceConfigPublicKey;\r\n  publicParams: FhevmInstanceConfigPublicParams | null;\r\n}> {\r\n  const db = await _getDB();\r\n  if (!db) {\r\n    return { publicParams: null };\r\n  }\r\n\r\n  let storedPublicKey: FhevmStoredPublicKey | null = null;\r\n  try {\r\n    const pk = await db.get(\"publicKeyStore\", aclAddress);\r\n    if (pk?.value) {\r\n      assertFhevmStoredPublicKey(pk.value);\r\n      storedPublicKey = pk.value;\r\n    }\r\n  } catch {\r\n    //\r\n  }\r\n\r\n  let storedPublicParams: FhevmStoredPublicParams | null = null;\r\n  try {\r\n    const pp = await db.get(\"paramsStore\", aclAddress);\r\n    if (pp?.value) {\r\n      assertFhevmStoredPublicParams(pp.value);\r\n      storedPublicParams = pp.value;\r\n    }\r\n  } catch {\r\n    //\r\n  }\r\n\r\n  const publicKeyData = storedPublicKey?.publicKey;\r\n  const publicKeyId = storedPublicKey?.publicKeyId;\r\n  const publicParams = storedPublicParams\r\n    ? {\r\n        \"2048\": storedPublicParams,\r\n      }\r\n    : null;\r\n\r\n  let publicKey: FhevmInstanceConfigPublicKey | undefined = undefined;\r\n\r\n  if (publicKeyId && publicKeyData) {\r\n    publicKey = {\r\n      id: publicKeyId,\r\n      data: publicKeyData,\r\n    };\r\n  }\r\n\r\n  return {\r\n    ...(publicKey !== undefined && { publicKey }),\r\n    publicParams,\r\n  };\r\n}\r\n\r\nexport async function publicKeyStorageSet(\r\n  aclAddress: `0x${string}`,\r\n  publicKey: FhevmStoredPublicKey | null,\r\n  publicParams: FhevmStoredPublicParams | null\r\n) {\r\n  assertFhevmStoredPublicKey(publicKey);\r\n  assertFhevmStoredPublicParams(publicParams);\r\n\r\n  const db = await _getDB();\r\n  if (!db) {\r\n    return;\r\n  }\r\n\r\n  if (publicKey) {\r\n    await db.put(\"publicKeyStore\", { acl: aclAddress, value: publicKey });\r\n  }\r\n\r\n  if (publicParams) {\r\n    await db.put(\"paramsStore\", { acl: aclAddress, value: publicParams });\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 300, "column": 0}, "map": {"version":3,"sources":["file:///E:/zama4/time-quill-vault/frontend/fhevm/internal/fhevm.ts"],"sourcesContent":["import { isAddress, Eip1193Provider, JsonRpcProvider } from \"ethers\";\r\nimport type {\r\n  FhevmInitSDKOptions,\r\n  FhevmInitSDKType,\r\n  FhevmLoadSDKType,\r\n  FhevmWindowType,\r\n} from \"./fhevmTypes\";\r\nimport { isFhevmWindowType, RelayerSDKLoader } from \"./RelayerSDKLoader\";\r\nimport { publicKeyStorageGet, publicKeyStorageSet } from \"./PublicKeyStorage\";\r\nimport { FhevmInstance, FhevmInstanceConfig } from \"../fhevmTypes\";\r\n\r\nexport class FhevmReactError extends Error {\r\n  code: string;\r\n  constructor(code: string, message?: string, options?: ErrorOptions) {\r\n    super(message, options);\r\n    this.code = code;\r\n    this.name = \"FhevmReactError\";\r\n  }\r\n}\r\n\r\nfunction throwFhevmError(\r\n  code: string,\r\n  message?: string,\r\n  cause?: unknown\r\n): never {\r\n  throw new FhevmReactError(code, message, cause ? { cause } : undefined);\r\n}\r\n\r\nconst isFhevmInitialized = (): boolean => {\r\n  if (!isFhevmWindowType(window, console.log)) {\r\n    return false;\r\n  }\r\n  return window.relayerSDK.__initialized__ === true;\r\n};\r\n\r\nconst fhevmLoadSDK: FhevmLoadSDKType = () => {\r\n  const loader = new RelayerSDKLoader({ trace: console.log });\r\n  return loader.load();\r\n};\r\n\r\nconst fhevmInitSDK: FhevmInitSDKType = async (\r\n  options?: FhevmInitSDKOptions\r\n) => {\r\n  if (!isFhevmWindowType(window, console.log)) {\r\n    throw new Error(\"window.relayerSDK is not available\");\r\n  }\r\n  const result = await window.relayerSDK.initSDK(options);\r\n  window.relayerSDK.__initialized__ = result;\r\n  if (!result) {\r\n    throw new Error(\"window.relayerSDK.initSDK failed.\");\r\n  }\r\n  return true;\r\n};\r\n\r\nfunction checkIsAddress(a: unknown): a is `0x${string}` {\r\n  if (typeof a !== \"string\") {\r\n    return false;\r\n  }\r\n  if (!isAddress(a)) {\r\n    return false;\r\n  }\r\n  return true;\r\n}\r\n\r\nexport class FhevmAbortError extends Error {\r\n  constructor(message = \"FHEVM operation was cancelled\") {\r\n    super(message);\r\n    this.name = \"FhevmAbortError\";\r\n  }\r\n}\r\n\r\ntype FhevmRelayerStatusType =\r\n  | \"sdk-loading\"\r\n  | \"sdk-loaded\"\r\n  | \"sdk-initializing\"\r\n  | \"sdk-initialized\"\r\n  | \"creating\";\r\n\r\nasync function getChainId(\r\n  providerOrUrl: Eip1193Provider | string\r\n): Promise<number> {\r\n  if (typeof providerOrUrl === \"string\") {\r\n    const provider = new JsonRpcProvider(providerOrUrl);\r\n    return Number((await provider.getNetwork()).chainId);\r\n  }\r\n  const chainId = await providerOrUrl.request({ method: \"eth_chainId\" });\r\n  return Number.parseInt(chainId as string, 16);\r\n}\r\n\r\nasync function getWeb3Client(rpcUrl: string) {\r\n  const rpc = new JsonRpcProvider(rpcUrl);\r\n  try {\r\n    const version = await rpc.send(\"web3_clientVersion\", []);\r\n    return version;\r\n  } catch (e) {\r\n    throwFhevmError(\r\n      \"WEB3_CLIENTVERSION_ERROR\",\r\n      `The URL ${rpcUrl} is not a Web3 node or is not reachable. Please check the endpoint.`,\r\n      e\r\n    );\r\n  } finally {\r\n    rpc.destroy();\r\n  }\r\n}\r\n\r\nasync function tryFetchFHEVMHardhatNodeRelayerMetadata(rpcUrl: string): Promise<\r\n  | {\r\n      ACLAddress: `0x${string}`;\r\n      InputVerifierAddress: `0x${string}`;\r\n      KMSVerifierAddress: `0x${string}`;\r\n    }\r\n  | undefined\r\n> {\r\n  const version = await getWeb3Client(rpcUrl);\r\n  if (\r\n    typeof version !== \"string\" ||\r\n    !version.toLowerCase().includes(\"hardhat\")\r\n  ) {\r\n    // Not a Hardhat Node\r\n    return undefined;\r\n  }\r\n  try {\r\n    const metadata = await getFHEVMRelayerMetadata(rpcUrl);\r\n    if (!metadata || typeof metadata !== \"object\") {\r\n      return undefined;\r\n    }\r\n    if (\r\n      !(\r\n        \"ACLAddress\" in metadata &&\r\n        typeof metadata.ACLAddress === \"string\" &&\r\n        metadata.ACLAddress.startsWith(\"0x\")\r\n      )\r\n    ) {\r\n      return undefined;\r\n    }\r\n    if (\r\n      !(\r\n        \"InputVerifierAddress\" in metadata &&\r\n        typeof metadata.InputVerifierAddress === \"string\" &&\r\n        metadata.InputVerifierAddress.startsWith(\"0x\")\r\n      )\r\n    ) {\r\n      return undefined;\r\n    }\r\n    if (\r\n      !(\r\n        \"KMSVerifierAddress\" in metadata &&\r\n        typeof metadata.KMSVerifierAddress === \"string\" &&\r\n        metadata.KMSVerifierAddress.startsWith(\"0x\")\r\n      )\r\n    ) {\r\n      return undefined;\r\n    }\r\n    return metadata;\r\n  } catch {\r\n    // Not a FHEVM Hardhat Node\r\n    return undefined;\r\n  }\r\n}\r\n\r\nasync function getFHEVMRelayerMetadata(rpcUrl: string) {\r\n  const rpc = new JsonRpcProvider(rpcUrl);\r\n  try {\r\n    const version = await rpc.send(\"fhevm_relayer_metadata\", []);\r\n    return version;\r\n  } catch (e) {\r\n    throwFhevmError(\r\n      \"FHEVM_RELAYER_METADATA_ERROR\",\r\n      `The URL ${rpcUrl} is not a FHEVM Hardhat node or is not reachable. Please check the endpoint.`,\r\n      e\r\n    );\r\n  } finally {\r\n    rpc.destroy();\r\n  }\r\n}\r\n\r\ntype MockResolveResult = { isMock: true; chainId: number; rpcUrl: string };\r\ntype GenericResolveResult = { isMock: false; chainId: number; rpcUrl?: string };\r\ntype ResolveResult = MockResolveResult | GenericResolveResult;\r\n\r\nasync function resolve(\r\n  providerOrUrl: Eip1193Provider | string,\r\n  mockChains?: Record<number, string>\r\n): Promise<ResolveResult> {\r\n  // Resolve chainId\r\n  const chainId = await getChainId(providerOrUrl);\r\n\r\n  // Resolve rpc url\r\n  let rpcUrl = typeof providerOrUrl === \"string\" ? providerOrUrl : undefined;\r\n\r\n  const _mockChains: Record<number, string> = {\r\n    31337: \"http://localhost:8545\",\r\n    ...(mockChains ?? {}),\r\n  };\r\n\r\n  // Help Typescript solver here:\r\n  if (Object.hasOwn(_mockChains, chainId)) {\r\n    if (!rpcUrl) {\r\n      rpcUrl = _mockChains[chainId];\r\n    }\r\n\r\n    return { isMock: true, chainId, rpcUrl };\r\n  }\r\n\r\n  return { isMock: false, chainId, rpcUrl };\r\n}\r\n\r\nexport const createFhevmInstance = async (parameters: {\r\n  provider: Eip1193Provider | string;\r\n  mockChains?: Record<number, string>;\r\n  signal: AbortSignal;\r\n  onStatusChange?: (status: FhevmRelayerStatusType) => void;\r\n}): Promise<FhevmInstance> => {\r\n  const throwIfAborted = () => {\r\n    if (signal.aborted) throw new FhevmAbortError();\r\n  };\r\n\r\n  const notify = (status: FhevmRelayerStatusType) => {\r\n    if (onStatusChange) onStatusChange(status);\r\n  };\r\n\r\n  const {\r\n    signal,\r\n    onStatusChange,\r\n    provider: providerOrUrl,\r\n    mockChains,\r\n  } = parameters;\r\n\r\n  // Resolve chainId\r\n  const { isMock, rpcUrl, chainId } = await resolve(providerOrUrl, mockChains);\r\n\r\n  if (isMock) {\r\n    // Throws an error if cannot connect or url does not refer to a Web3 client\r\n    const fhevmRelayerMetadata =\r\n      await tryFetchFHEVMHardhatNodeRelayerMetadata(rpcUrl);\r\n\r\n    if (fhevmRelayerMetadata) {\r\n      // fhevmRelayerMetadata is defined, which means rpcUrl refers to a FHEVM Hardhat Node\r\n      notify(\"creating\");\r\n\r\n      //////////////////////////////////////////////////////////////////////////\r\n      // \r\n      // WARNING!!\r\n      // ALWAY USE DYNAMIC IMPORT TO AVOID INCLUDING THE ENTIRE FHEVM MOCK LIB \r\n      // IN THE FINAL PRODUCTION BUNDLE!!\r\n      // \r\n      //////////////////////////////////////////////////////////////////////////\r\n      const fhevmMock = await import(\"./mock/fhevmMock\");\r\n      const mockInstance = await fhevmMock.fhevmMockCreateInstance({\r\n        rpcUrl,\r\n        chainId,\r\n        metadata: fhevmRelayerMetadata,\r\n      });\r\n\r\n      throwIfAborted();\r\n\r\n      return mockInstance;\r\n    }\r\n  }\r\n\r\n  throwIfAborted();\r\n\r\n  if (!isFhevmWindowType(window, console.log)) {\r\n    notify(\"sdk-loading\");\r\n\r\n    // throws an error if failed\r\n    await fhevmLoadSDK();\r\n    throwIfAborted();\r\n\r\n    notify(\"sdk-loaded\");\r\n  }\r\n\r\n  // notify that state === \"sdk-loaded\"\r\n\r\n  if (!isFhevmInitialized()) {\r\n    notify(\"sdk-initializing\");\r\n\r\n    // throws an error if failed\r\n    await fhevmInitSDK();\r\n    throwIfAborted();\r\n\r\n    notify(\"sdk-initialized\");\r\n  }\r\n\r\n  const relayerSDK = (window as unknown as FhevmWindowType).relayerSDK;\r\n\r\n  const aclAddress = relayerSDK.SepoliaConfig.aclContractAddress;\r\n  if (!checkIsAddress(aclAddress)) {\r\n    throw new Error(`Invalid address: ${aclAddress}`);\r\n  }\r\n\r\n  const pub = await publicKeyStorageGet(aclAddress);\r\n  throwIfAborted();\r\n\r\n  const config: FhevmInstanceConfig = {\r\n    ...relayerSDK.SepoliaConfig,\r\n    network: providerOrUrl,\r\n    publicKey: pub.publicKey,\r\n    publicParams: pub.publicParams,\r\n  };\r\n\r\n  // notify that state === \"creating\"\r\n  notify(\"creating\");\r\n\r\n  const instance = await relayerSDK.createInstance(config);\r\n\r\n  // Save the key even if aborted\r\n  await publicKeyStorageSet(\r\n    aclAddress,\r\n    instance.getPublicKey(),\r\n    instance.getPublicParams(2048)\r\n  );\r\n\r\n  throwIfAborted();\r\n\r\n  return instance;\r\n};\r\n\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 528, "column": 0}, "map": {"version":3,"sources":["file:///E:/zama4/time-quill-vault/frontend/fhevm/useFhevm.tsx"],"sourcesContent":["import { ethers } from \"ethers\";\r\nimport { useCallback, useEffect, useRef, useState } from \"react\";\r\nimport type { FhevmInstance } from \"./fhevmTypes\";\r\nimport { createFhevmInstance } from \"./internal/fhevm\";\r\n\r\nfunction _assert(condition: boolean, message?: string): asserts condition {\r\n  if (!condition) {\r\n    const m = message ? `Assertion failed: ${message}` : `Assertion failed.`;\r\n    console.error(m);\r\n    throw new Error(m);\r\n  }\r\n}\r\n\r\nexport type FhevmGoState = \"idle\" | \"loading\" | \"ready\" | \"error\";\r\n\r\nexport function useFhevm(parameters: {\r\n  provider: string | ethers.Eip1193Provider | undefined;\r\n  chainId: number | undefined;\r\n  enabled?: boolean;\r\n  initialMockChains?: Readonly<Record<number, string>>;  \r\n}): {\r\n  instance: FhevmInstance | undefined;\r\n  refresh: () => void;\r\n  error: Error | undefined;\r\n  status: FhevmGoState;\r\n} {\r\n  const { provider, chainId, initialMockChains, enabled = true } = parameters;\r\n\r\n  const [instance, _setInstance] = useState<FhevmInstance | undefined>(\r\n    undefined\r\n  );\r\n  const [status, _setStatus] = useState<FhevmGoState>(\"idle\");\r\n  const [error, _setError] = useState<Error | undefined>(undefined);\r\n  const [_isRunning, _setIsRunning] = useState<boolean>(enabled);\r\n  const [_providerChanged, _setProviderChanged] = useState<number>(0);\r\n  const _abortControllerRef = useRef<AbortController | null>(null);\r\n  const _providerRef = useRef<string | ethers.Eip1193Provider | undefined>(\r\n    provider\r\n  );\r\n  const _chainIdRef = useRef<number | undefined>(chainId);\r\n  const _mockChainsRef = useRef<Record<number, string> | undefined>(\r\n    initialMockChains\r\n  );\r\n\r\n  const refresh = useCallback(() => {\r\n    // Provider or chainId has changed. Abort immediately\r\n    if (_abortControllerRef.current) {\r\n      // Make sure _providerRef.current + _chainIdRef.current are undefined during abort\r\n      _providerRef.current = undefined;\r\n      _chainIdRef.current = undefined;\r\n\r\n      _abortControllerRef.current.abort();\r\n      _abortControllerRef.current = null;\r\n    }\r\n\r\n    _providerRef.current = provider;\r\n    _chainIdRef.current = chainId;\r\n\r\n    // Nullify instance immediately\r\n    _setInstance(undefined);\r\n    _setError(undefined);\r\n    _setStatus(\"idle\");\r\n\r\n    if (provider !== undefined) {\r\n      // Force call main useEffect\r\n      _setProviderChanged((prev) => prev + 1);\r\n    }\r\n\r\n    // Do not modify the running flag.\r\n  }, [provider, chainId]);\r\n\r\n  // Merge in main useEffect!!!\r\n  useEffect(() => {\r\n    refresh();\r\n  }, [refresh]);\r\n\r\n  useEffect(() => {\r\n    _setIsRunning(enabled);\r\n  }, [enabled]);\r\n\r\n  // Main useEffect\r\n  useEffect(() => {\r\n    // is _providerRef.current valid here ?\r\n    // even if the first useEffect is rendered in the same render-cycle ?\r\n    if (_isRunning === false) {\r\n      // cancelled\r\n      console.log(\"cancelled\");\r\n      if (_abortControllerRef.current) {\r\n        _abortControllerRef.current.abort();\r\n        _abortControllerRef.current = null;\r\n      }\r\n      // May already be null if provider was changed in the previous render-cycle\r\n      _setInstance(undefined);\r\n      _setError(undefined);\r\n      _setStatus(\"idle\");\r\n      return;\r\n    }\r\n\r\n    if (_isRunning === true) {\r\n      if (_providerRef.current === undefined) {\r\n        // instance should be undefined\r\n        // this code below should be unecessary\r\n        _setInstance(undefined);\r\n        _setError(undefined);\r\n        _setStatus(\"idle\");\r\n        return;\r\n      }\r\n\r\n      if (!_abortControllerRef.current) {\r\n        _abortControllerRef.current = new AbortController();\r\n      }\r\n\r\n      _assert(\r\n        !_abortControllerRef.current.signal.aborted,\r\n        \"!controllerRef.current.signal.aborted\"\r\n      );\r\n\r\n      // Keep old instance\r\n      // Was set to undefined if provider changed\r\n      _setStatus(\"loading\");\r\n      _setError(undefined);\r\n\r\n      const thisSignal = _abortControllerRef.current.signal;\r\n      const thisProvider = _providerRef.current;\r\n      // Can be undefined, if so, call eth_chainId\r\n      const thisRpcUrlsByChainId = _mockChainsRef.current;\r\n\r\n      createFhevmInstance({\r\n        signal: thisSignal,\r\n        provider: thisProvider,\r\n        mockChains: thisRpcUrlsByChainId,\r\n        onStatusChange: (s) =>\r\n          console.log(`[useFhevm] createFhevmInstance status changed: ${s}`),\r\n      })\r\n        .then((i) => {\r\n          console.log(`[useFhevm] createFhevmInstance created!`);\r\n          //console.log(`completed (runId=${thisRunId})...`);\r\n          if (thisSignal.aborted) return;\r\n\r\n          // is there a edge case where the assert below would fail ?\r\n          // it's not possible to have a _providerRef modified without a prior abort\r\n          _assert(\r\n            thisProvider === _providerRef.current,\r\n            \"thisProvider === _providerRef.current\"\r\n          );\r\n\r\n          _setInstance(i);\r\n          _setError(undefined);\r\n          _setStatus(\"ready\");\r\n        })\r\n        .catch((e) => {\r\n          console.log(`Error Was thrown !!! error... ` + e.name);\r\n          if (thisSignal.aborted) return;\r\n\r\n          // it's not possible to have a _providerRef modified without a prior abort\r\n          _assert(\r\n            thisProvider === _providerRef.current,\r\n            \"thisProvider === _providerRef.current\"\r\n          );\r\n\r\n          _setInstance(undefined);\r\n          _setError(e);\r\n          _setStatus(\"error\");\r\n        });\r\n    }\r\n  }, [_isRunning, _providerChanged]);\r\n\r\n  return { instance, refresh, error, status };\r\n}\r\n\r\n"],"names":[],"mappings":";;;;AACA;AAEA;;;;AAEA,SAAS,QAAQ,SAAkB,EAAE,OAAgB;IACnD,IAAI,CAAC,WAAW;QACd,MAAM,IAAI,UAAU,AAAC,qBAA4B,OAAR,WAAa;QACtD,QAAQ,KAAK,CAAC;QACd,MAAM,IAAI,MAAM;IAClB;AACF;AAIO,SAAS,SAAS,UAKxB;;IAMC,MAAM,EAAE,QAAQ,EAAE,OAAO,EAAE,iBAAiB,EAAE,UAAU,IAAI,EAAE,GAAG;IAEjE,MAAM,CAAC,UAAU,aAAa,GAAG,IAAA,qLAAQ,EACvC;IAEF,MAAM,CAAC,QAAQ,WAAW,GAAG,IAAA,qLAAQ,EAAe;IACpD,MAAM,CAAC,OAAO,UAAU,GAAG,IAAA,qLAAQ,EAAoB;IACvD,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,qLAAQ,EAAU;IACtD,MAAM,CAAC,kBAAkB,oBAAoB,GAAG,IAAA,qLAAQ,EAAS;IACjE,MAAM,sBAAsB,IAAA,mLAAM,EAAyB;IAC3D,MAAM,eAAe,IAAA,mLAAM,EACzB;IAEF,MAAM,cAAc,IAAA,mLAAM,EAAqB;IAC/C,MAAM,iBAAiB,IAAA,mLAAM,EAC3B;IAGF,MAAM,UAAU,IAAA,wLAAW;yCAAC;YAC1B,qDAAqD;YACrD,IAAI,oBAAoB,OAAO,EAAE;gBAC/B,kFAAkF;gBAClF,aAAa,OAAO,GAAG;gBACvB,YAAY,OAAO,GAAG;gBAEtB,oBAAoB,OAAO,CAAC,KAAK;gBACjC,oBAAoB,OAAO,GAAG;YAChC;YAEA,aAAa,OAAO,GAAG;YACvB,YAAY,OAAO,GAAG;YAEtB,+BAA+B;YAC/B,aAAa;YACb,UAAU;YACV,WAAW;YAEX,IAAI,aAAa,WAAW;gBAC1B,4BAA4B;gBAC5B;qDAAoB,CAAC,OAAS,OAAO;;YACvC;QAEA,kCAAkC;QACpC;wCAAG;QAAC;QAAU;KAAQ;IAEtB,6BAA6B;IAC7B,IAAA,sLAAS;8BAAC;YACR;QACF;6BAAG;QAAC;KAAQ;IAEZ,IAAA,sLAAS;8BAAC;YACR,cAAc;QAChB;6BAAG;QAAC;KAAQ;IAEZ,iBAAiB;IACjB,IAAA,sLAAS;8BAAC;YACR,uCAAuC;YACvC,qEAAqE;YACrE,IAAI,eAAe,OAAO;gBACxB,YAAY;gBACZ,QAAQ,GAAG,CAAC;gBACZ,IAAI,oBAAoB,OAAO,EAAE;oBAC/B,oBAAoB,OAAO,CAAC,KAAK;oBACjC,oBAAoB,OAAO,GAAG;gBAChC;gBACA,2EAA2E;gBAC3E,aAAa;gBACb,UAAU;gBACV,WAAW;gBACX;YACF;YAEA,IAAI,eAAe,MAAM;gBACvB,IAAI,aAAa,OAAO,KAAK,WAAW;oBACtC,+BAA+B;oBAC/B,uCAAuC;oBACvC,aAAa;oBACb,UAAU;oBACV,WAAW;oBACX;gBACF;gBAEA,IAAI,CAAC,oBAAoB,OAAO,EAAE;oBAChC,oBAAoB,OAAO,GAAG,IAAI;gBACpC;gBAEA,QACE,CAAC,oBAAoB,OAAO,CAAC,MAAM,CAAC,OAAO,EAC3C;gBAGF,oBAAoB;gBACpB,2CAA2C;gBAC3C,WAAW;gBACX,UAAU;gBAEV,MAAM,aAAa,oBAAoB,OAAO,CAAC,MAAM;gBACrD,MAAM,eAAe,aAAa,OAAO;gBACzC,4CAA4C;gBAC5C,MAAM,uBAAuB,eAAe,OAAO;gBAEnD,IAAA,gKAAmB,EAAC;oBAClB,QAAQ;oBACR,UAAU;oBACV,YAAY;oBACZ,cAAc;8CAAE,CAAC,IACf,QAAQ,GAAG,CAAC,AAAC,kDAAmD,OAAF;;gBAClE,GACG,IAAI;0CAAC,CAAC;wBACL,QAAQ,GAAG,CAAE;wBACb,mDAAmD;wBACnD,IAAI,WAAW,OAAO,EAAE;wBAExB,2DAA2D;wBAC3D,0EAA0E;wBAC1E,QACE,iBAAiB,aAAa,OAAO,EACrC;wBAGF,aAAa;wBACb,UAAU;wBACV,WAAW;oBACb;yCACC,KAAK;0CAAC,CAAC;wBACN,QAAQ,GAAG,CAAC,AAAC,mCAAkC,EAAE,IAAI;wBACrD,IAAI,WAAW,OAAO,EAAE;wBAExB,0EAA0E;wBAC1E,QACE,iBAAiB,aAAa,OAAO,EACrC;wBAGF,aAAa;wBACb,UAAU;wBACV,WAAW;oBACb;;YACJ;QACF;6BAAG;QAAC;QAAY;KAAiB;IAEjC,OAAO;QAAE;QAAU;QAAS;QAAO;IAAO;AAC5C;GAzJgB","debugId":null}},
    {"offset": {"line": 689, "column": 0}, "map": {"version":3,"sources":["file:///E:/zama4/time-quill-vault/frontend/hooks/useEthersSigner.ts"],"sourcesContent":["import { useMemo, useEffect, useState } from 'react';\r\nimport { useWalletClient } from 'wagmi';\r\nimport { BrowserProvider, JsonRpcSigner } from 'ethers';\r\n\r\nasync function walletClientToSigner(walletClient: any): Promise<JsonRpcSigner> {\r\n  const { account, chain, transport } = walletClient;\r\n  const network = {\r\n    chainId: chain.id,\r\n    name: chain.name,\r\n    ensAddress: chain.contracts?.ensRegistry?.address,\r\n  };\r\n\r\n  const provider = new BrowserProvider(transport, network);\r\n  const signer = await provider.getSigner(account.address);\r\n  return signer;\r\n}\r\n\r\nexport function useEthersSigner({ chainId }: { chainId?: number } = {}) {\r\n  const { data: walletClient } = useWalletClient({ chainId });\r\n  const [signer, setSigner] = useState<JsonRpcSigner | undefined>(undefined);\r\n\r\n  useEffect(() => {\r\n    if (walletClient) {\r\n      walletClientToSigner(walletClient).then(setSigner);\r\n    } else {\r\n      setSigner(undefined);\r\n    }\r\n  }, [walletClient]);\r\n\r\n  return useMemo(() => signer, [signer]);\r\n}\r\n\r\nexport function useEthersProvider({ chainId }: { chainId?: number } = {}) {\r\n  const { data: walletClient } = useWalletClient({ chainId });\r\n  const provider = useMemo(() => {\r\n    if (!walletClient) return undefined;\r\n    const { chain, transport } = walletClient;\r\n    const network = {\r\n      chainId: chain.id,\r\n      name: chain.name,\r\n      ensAddress: chain.contracts?.ensRegistry?.address,\r\n    };\r\n    return new BrowserProvider(transport, network);\r\n  }, [walletClient]);\r\n  return provider;\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;;AAEA,eAAe,qBAAqB,YAAiB;QAKrC,8BAAA;IAJd,MAAM,EAAE,OAAO,EAAE,KAAK,EAAE,SAAS,EAAE,GAAG;IACtC,MAAM,UAAU;QACd,SAAS,MAAM,EAAE;QACjB,MAAM,MAAM,IAAI;QAChB,UAAU,GAAE,mBAAA,MAAM,SAAS,cAAf,wCAAA,+BAAA,iBAAiB,WAAW,cAA5B,mDAAA,6BAA8B,OAAO;IACnD;IAEA,MAAM,WAAW,IAAI,0MAAe,CAAC,WAAW;IAChD,MAAM,SAAS,MAAM,SAAS,SAAS,CAAC,QAAQ,OAAO;IACvD,OAAO;AACT;AAEO,SAAS;QAAgB,EAAE,OAAO,EAAwB,GAAjC,iEAAoC,CAAC;;IACnE,MAAM,EAAE,MAAM,YAAY,EAAE,GAAG,IAAA,kMAAe,EAAC;QAAE;IAAQ;IACzD,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,qLAAQ,EAA4B;IAEhE,IAAA,sLAAS;qCAAC;YACR,IAAI,cAAc;gBAChB,qBAAqB,cAAc,IAAI,CAAC;YAC1C,OAAO;gBACL,UAAU;YACZ;QACF;oCAAG;QAAC;KAAa;IAEjB,OAAO,IAAA,oLAAO;mCAAC,IAAM;kCAAQ;QAAC;KAAO;AACvC;GAbgB;;QACiB,kMAAe;;;AAczC,SAAS;QAAkB,EAAE,OAAO,EAAwB,GAAjC,iEAAoC,CAAC;;IACrE,MAAM,EAAE,MAAM,YAAY,EAAE,GAAG,IAAA,kMAAe,EAAC;QAAE;IAAQ;IACzD,MAAM,WAAW,IAAA,oLAAO;+CAAC;gBAMT,8BAAA;YALd,IAAI,CAAC,cAAc,OAAO;YAC1B,MAAM,EAAE,KAAK,EAAE,SAAS,EAAE,GAAG;YAC7B,MAAM,UAAU;gBACd,SAAS,MAAM,EAAE;gBACjB,MAAM,MAAM,IAAI;gBAChB,UAAU,GAAE,mBAAA,MAAM,SAAS,cAAf,wCAAA,+BAAA,iBAAiB,WAAW,cAA5B,mDAAA,6BAA8B,OAAO;YACnD;YACA,OAAO,IAAI,0MAAe,CAAC,WAAW;QACxC;8CAAG;QAAC;KAAa;IACjB,OAAO;AACT;IAbgB;;QACiB,kMAAe","debugId":null}},
    {"offset": {"line": 778, "column": 0}, "map": {"version":3,"sources":["file:///E:/zama4/time-quill-vault/frontend/components/InheritanceCheckDemo.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useCallback, useEffect, useMemo } from \"react\";\nimport { useAccount, useReadContract, useWriteContract, useChainId, useWaitForTransactionReceipt } from \"wagmi\";\nimport { useFhevm } from \"../fhevm/useFhevm\";\nimport { useInMemoryStorage } from \"../hooks/useInMemoryStorage\";\nimport { useEthersProvider, useEthersSigner } from \"../hooks/useEthersSigner\";\nimport { ethers } from \"ethers\";\n\n// Contract ABI - This will be generated after compilation\nconst INHERITANCE_RULE_CHECK_ABI = [\n  {\n    inputs: [\n      { internalType: \"externalEuint32\", name: \"encryptedAge\", type: \"bytes32\" },\n      { internalType: \"bytes\", name: \"inputProof\", type: \"bytes\" },\n    ],\n    name: \"checkEligibility\",\n    outputs: [{ internalType: \"ebool\", name: \"\", type: \"bytes32\" }],\n    stateMutability: \"nonpayable\",\n    type: \"function\",\n  },\n  {\n    inputs: [],\n    name: \"getMyEligibilityResult\",\n    outputs: [{ internalType: \"ebool\", name: \"\", type: \"bytes32\" }],\n    stateMutability: \"view\",\n    type: \"function\",\n  },\n  {\n    inputs: [{ internalType: \"address\", name: \"user\", type: \"address\" }],\n    name: \"getEligibilityResult\",\n    outputs: [{ internalType: \"ebool\", name: \"\", type: \"bytes32\" }],\n    stateMutability: \"view\",\n    type: \"function\",\n  },\n] as const;\n\n// Contract address - Default to localhost deployment address\n// For localhost network (chainId: 31337): 0x5FbDB2315678afecb367f032d93F642f64180aa3\n// Override with NEXT_PUBLIC_CONTRACT_ADDRESS environment variable if needed\nconst CONTRACT_ADDRESS = process.env.NEXT_PUBLIC_CONTRACT_ADDRESS || \"0x5FbDB2315678afecb367f032d93F642f64180aa3\";\n\nexport function InheritanceCheckDemo() {\n  const [mounted, setMounted] = useState(false);\n  \n  const { address, isConnected } = useAccount();\n  const chainId = useChainId();\n  const { writeContract, data: txHash, isPending: isWritePending, error: writeError, reset: resetWrite } = useWriteContract();\n  \n  // Wait for transaction confirmation\n  const { isLoading: isConfirming, isSuccess: isConfirmed, data: txReceipt } = useWaitForTransactionReceipt({\n    hash: txHash,\n  });\n\n  const [age, setAge] = useState(\"\");\n  const [encryptedResult, setEncryptedResult] = useState<string | null>(null);\n  const [decryptedResult, setDecryptedResult] = useState<boolean | null>(null);\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [isDecrypting, setIsDecrypting] = useState(false);\n  const [message, setMessage] = useState(\"\");\n\n  // Only initialize after client-side mount to avoid SSR hydration issues\n  useEffect(() => {\n    setMounted(true);\n  }, []);\n\n  const { storage: fhevmDecryptionSignatureStorage } = useInMemoryStorage();\n\n  // Get provider and signer from wagmi\n  const ethersProvider = useEthersProvider({ chainId });\n  const signer = useEthersSigner({ chainId });\n\n  // For FHEVM, use window.ethereum (EIP-1193 provider) or RPC URL for mock chains\n  // FHEVM requires either a string URL or an EIP-1193 provider with request method\n  const fhevmProvider = useMemo(() => {\n    if (!mounted || !isConnected || !chainId) return undefined;\n    \n    // For localhost/mock chains, pass the RPC URL directly\n    if (chainId === 31337) {\n      return \"http://localhost:8545\";\n    }\n    \n    // For real networks, use window.ethereum if available (EIP-1193 provider)\n    if (typeof window !== \"undefined\" && window.ethereum) {\n      return window.ethereum as any;\n    }\n    \n    return undefined;\n  }, [mounted, isConnected, chainId]);\n\n  // FHEVM instance - only initialize after mount to avoid SSR hydration issues\n  const {\n    instance: fhevmInstance,\n    status: fhevmStatus,\n    error: fhevmError,\n  } = useFhevm({\n    provider: fhevmProvider,\n    chainId,\n    initialMockChains: { 31337: \"http://localhost:8545\" },\n    enabled: mounted && isConnected && !!fhevmProvider,\n  });\n\n  // Read eligibility result - Using getEligibilityResult(address) is more reliable than getMyEligibilityResult()\n  // because read-only calls often don't set msg.sender correctly.\n  const { data: eligibilityHandle, refetch: refetchEligibility } = useReadContract({\n    address: CONTRACT_ADDRESS as `0x${string}`,\n    abi: INHERITANCE_RULE_CHECK_ABI,\n    functionName: \"getEligibilityResult\",\n    args: address ? [address as `0x${string}`] : undefined,\n    query: {\n      enabled: isConnected && !!address && CONTRACT_ADDRESS !== \"0x0000000000000000000000000000000000000000\",\n    },\n  });\n\n  const handleSubmitAge = useCallback(async () => {\n    // Clear previous messages\n    setMessage(\"\");\n    \n    if (!fhevmInstance) {\n      setMessage(\"Error: FHEVM instance not ready. Please wait for initialization.\");\n      return;\n    }\n\n    if (!address) {\n      setMessage(\"Error: Please connect your wallet first.\");\n      return;\n    }\n\n    if (!age || parseInt(age) <= 0) {\n      setMessage(\"Error: Please enter a valid age.\");\n      return;\n    }\n\n    if (CONTRACT_ADDRESS === \"0x0000000000000000000000000000000000000000\") {\n      setMessage(\"Error: Contract not deployed. Please deploy the contract first.\");\n      return;\n    }\n\n    setIsSubmitting(true);\n    setMessage(\"Encrypting age...\");\n\n    try {\n      // Create encrypted input\n      const input = fhevmInstance.createEncryptedInput(CONTRACT_ADDRESS, address);\n      input.add32(parseInt(age));\n      const encryptedInput = await input.encrypt();\n\n      // Convert inputProof from Uint8Array to hex string for viem/wagmi\n      // inputProof is Uint8Array, we need to convert it to hex string\n      let inputProofHex: string;\n      if (encryptedInput.inputProof instanceof Uint8Array) {\n        // Convert Uint8Array to hex string\n        inputProofHex = \"0x\" + Array.from(encryptedInput.inputProof)\n          .map(b => b.toString(16).padStart(2, \"0\"))\n          .join(\"\");\n      } else {\n        // If it's already a string, use it directly\n        inputProofHex = encryptedInput.inputProof as string;\n        if (!inputProofHex.startsWith(\"0x\")) {\n          inputProofHex = \"0x\" + inputProofHex;\n        }\n      }\n\n      // Ensure handles[0] is a hex string (handles can be bigint in some fhevmjs versions)\n      let handleHex: string;\n      const rawHandle = encryptedInput.handles[0];\n      \n      if (typeof rawHandle === \"bigint\") {\n        handleHex = \"0x\" + rawHandle.toString(16).padStart(64, \"0\");\n      } else if (typeof rawHandle === \"string\") {\n        handleHex = rawHandle.startsWith(\"0x\") ? rawHandle : \"0x\" + rawHandle;\n        if (handleHex.length < 66) {\n          handleHex = \"0x\" + handleHex.slice(2).padStart(64, \"0\");\n        }\n      } else {\n        // Uint8Array or other\n        handleHex = \"0x\" + Array.from(new Uint8Array(rawHandle as any))\n          .map((b: any) => b.toString(16).padStart(2, \"0\"))\n          .join(\"\");\n        if (handleHex.length < 66) {\n          handleHex = \"0x\" + handleHex.slice(2).padStart(64, \"0\");\n        }\n      }\n\n      // Reset any previous write errors\n      resetWrite();\n\n      setMessage(\"Preparing transaction... Please confirm in your wallet when it appears.\");\n\n      // Log transaction details for debugging\n      console.log(\"Submitting transaction:\", {\n        address: CONTRACT_ADDRESS,\n        functionName: \"checkEligibility\",\n        handleHex,\n        inputProofHex: inputProofHex.slice(0, 40) + \"...\",\n        chainId,\n        walletAddress: address,\n      });\n\n      // Call contract - this will trigger wallet popup\n      // Note: In wagmi v2, writeContract is called directly and will trigger wallet\n      // We add an explicit gas limit because FHEVM operations are heavy\n      writeContract({\n        address: CONTRACT_ADDRESS as `0x${string}`,\n        abi: INHERITANCE_RULE_CHECK_ABI,\n        functionName: \"checkEligibility\",\n        args: [handleHex as `0x${string}`, inputProofHex as `0x${string}`],\n        gas: BigInt(10000000), \n      });\n      \n      // Log that writeContract was called\n      console.log(\"writeContract called, waiting for wallet confirmation...\");\n      \n      // isWritePending will be true while waiting for user confirmation\n      // The message will be updated by useEffect when isWritePending changes\n    } catch (error: any) {\n      const errorMessage = error?.message || error?.toString() || \"Unknown error occurred\";\n      setMessage(`Error: ${errorMessage}`);\n      console.error(\"Submit error:\", error);\n      setIsSubmitting(false);\n    }\n  }, [fhevmInstance, address, age, writeContract]);\n\n  // Handle transaction confirmation and refetch result\n  useEffect(() => {\n    if (isConfirmed && txHash) {\n      if (txReceipt?.status === \"reverted\") {\n        setMessage(\" Transaction REVERTED! This usually means FHEVM node is not running or gas is insufficient.\");\n        setIsSubmitting(false);\n        return;\n      }\n      \n      const hashString = typeof txHash === 'string' ? txHash : String(txHash);\n      setMessage(` Transaction confirmed! Hash: ${hashString.slice(0, 10)}...`);\n      setIsSubmitting(false);\n      // Refetch eligibility result after transaction is confirmed\n      refetchEligibility();\n      setTimeout(() => {\n        setMessage(\"Check eligibility result below and decrypt to see if you're eligible.\");\n      }, 1000);\n    }\n  }, [isConfirmed, txHash, txReceipt, refetchEligibility]);\n\n  // Handle write errors\n  useEffect(() => {\n    if (writeError) {\n      console.error(\"Write contract error:\", writeError);\n      setMessage(`Transaction error: ${writeError.message || writeError.toString()}`);\n      setIsSubmitting(false);\n    }\n  }, [writeError]);\n\n  // Update message during confirmation\n  useEffect(() => {\n    if (isConfirming) {\n      setMessage(\"Transaction is being confirmed on the blockchain...\");\n    }\n  }, [isConfirming]);\n  \n  // Handle write pending state\n  useEffect(() => {\n    if (isWritePending && !txHash) {\n      setMessage(\"Waiting for wallet confirmation... Please check your wallet popup.\");\n    } else if (isWritePending && txHash) {\n      const hashString = typeof txHash === 'string' ? txHash : String(txHash);\n      setMessage(`Transaction submitted (${hashString.slice(0, 10)}...). Waiting for confirmation...`);\n    }\n  }, [isWritePending, txHash]);\n\n  const handleDecrypt = useCallback(async () => {\n    if (!fhevmInstance || !address || !eligibilityHandle) {\n      setMessage(\"No eligibility result to decrypt\");\n      return;\n    }\n\n    // Check if handle is zero\n    if (eligibilityHandle === \"0x0000000000000000000000000000000000000000000000000000000000000000\" || \n        !eligibilityHandle) {\n      setMessage(\"No eligibility result found. Please submit your age first.\");\n      return;\n    }\n\n    setIsDecrypting(true);\n    setMessage(\"Decrypting eligibility result...\");\n\n    try {\n      if (!signer) {\n        throw new Error(\"No signer available\");\n      }\n\n      // Generate keypair\n      const keypair = fhevmInstance.generateKeypair();\n\n      const startTimeStamp = Math.floor(Date.now() / 1000).toString();\n      const durationDays = \"10\";\n      const contractAddresses = [CONTRACT_ADDRESS];\n\n      // Create EIP712 signature\n      const eip712 = fhevmInstance.createEIP712(\n        keypair.publicKey,\n        contractAddresses,\n        startTimeStamp,\n        durationDays\n      );\n\n      const signature = await signer.signTypedData(\n        eip712.domain,\n        { UserDecryptRequestVerification: eip712.types.UserDecryptRequestVerification },\n        eip712.message\n      );\n\n      // Decrypt\n      const result = await fhevmInstance.userDecrypt(\n        [{ handle: eligibilityHandle, contractAddress: CONTRACT_ADDRESS }],\n        keypair.privateKey,\n        keypair.publicKey,\n        signature.replace(\"0x\", \"\"),\n        contractAddresses,\n        address,\n        startTimeStamp,\n        durationDays\n      );\n\n      const decryptedValue = result[eligibilityHandle];\n      const isEligible = Boolean(decryptedValue);\n      setDecryptedResult(isEligible);\n      setMessage(isEligible ? \"You are eligible for inheritance!\" : \"You are not yet eligible (age must be 18 or older)\");\n    } catch (error: any) {\n      setMessage(`Decrypt error: ${error.message}`);\n      console.error(\"Decrypt error:\", error);\n    } finally {\n      setIsDecrypting(false);\n    }\n  }, [fhevmInstance, address, eligibilityHandle, signer]);\n\n  // Wait for mount before checking connection status to avoid SSR hydration mismatch\n  // Ensure consistent structure between server and client\n  if (!mounted) {\n    return (\n      <div className=\"w-full space-y-6\">\n        {/* Loading overlay */}\n        <div className=\"page-transition-overlay\">\n          <div className=\"loading-spinner-container\">\n            <div className=\"loading-spinner-ring\"></div>\n            <div className=\"loading-spinner-ring\"></div>\n            <div className=\"loading-spinner-ring\"></div>\n            <div className=\"loading-center-icon\"></div>\n          </div>\n          <div className=\"loading-text\">Initializing Secure Environment</div>\n          <div className=\"loading-dots-container\">\n            <div className=\"loading-dot\"></div>\n            <div className=\"loading-dot\"></div>\n            <div className=\"loading-dot\"></div>\n          </div>\n          <div className=\"loading-progress-bar\">\n            <div className=\"loading-progress-fill\"></div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (!isConnected) {\n    return (\n      <div className=\"w-full space-y-6\">\n        <div className=\"panel-card\">\n          <div className=\"panel-shimmer\"></div>\n          <h1 className=\"text-3xl font-bold bg-gradient-to-r from-[var(--accent)] to-[var(--success)] bg-clip-text text-transparent mb-3\">\n            Encrypted Inheritance Rule Check\n          </h1>\n          <p className=\"text-[var(--text-secondary)] text-lg\">\n            Verify if you meet the inheritance requirement (age {'>='} 18) without revealing your actual age\n          </p>\n          \n          {/* Decorative badges */}\n          <div className=\"flex gap-2 mt-4\">\n            <span className=\"badge-decoration badge-pulse\">\n              <span></span> FHE Encrypted\n            </span>\n            <span className=\"badge-decoration badge-decoration-success\">\n              <span></span> Privacy First\n            </span>\n          </div>\n        </div>\n        \n        <div className=\"panel-card text-center\">\n          <div className=\"panel-shimmer\"></div>\n          <div className=\"py-8\">\n            <div className=\"text-6xl mb-4 result-icon\"></div>\n            <p className=\"text-xl font-semibold text-[var(--text-primary)] mb-2\">\n              Connect Your Wallet\n            </p>\n            <p className=\"text-[var(--text-secondary)]\">\n              Please connect your wallet to check inheritance eligibility\n            </p>\n          </div>\n          \n          {/* Decorative info card */}\n          <div className=\"info-card-decoration\">\n            <p className=\"text-sm text-[var(--text-secondary)]\">\n              Your age will be encrypted using Fully Homomorphic Encryption (FHE) technology, ensuring complete privacy.\n            </p>\n          </div>\n        </div>\n        \n        {/* Decorative stats */}\n        <div className=\"stats-decoration\">\n          <div className=\"stat-item\">\n            <div className=\"stat-value\">100%</div>\n            <div className=\"stat-label\">Private</div>\n          </div>\n          <div className=\"stat-item\">\n            <div className=\"stat-value\">FHE</div>\n            <div className=\"stat-label\">Encrypted</div>\n          </div>\n          <div className=\"stat-item\">\n            <div className=\"stat-value\">18+</div>\n            <div className=\"stat-label\">Requirement</div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"w-full space-y-6\">\n      {/* Hero Section */}\n      <div className=\"panel-card\">\n        <div className=\"panel-shimmer\"></div>\n        <h1 className=\"text-3xl font-bold bg-gradient-to-r from-[var(--accent)] to-[var(--success)] bg-clip-text text-transparent mb-3\">\n          Encrypted Inheritance Rule Check\n        </h1>\n        <p className=\"text-[var(--text-secondary)] text-lg\">\n          Verify if you meet the inheritance requirement (age {'>='} 18) without revealing your actual age using fully homomorphic encryption.\n        </p>\n        \n        {/* Decorative badges */}\n        <div className=\"flex flex-wrap gap-2 mt-4\">\n          <span className=\"badge-decoration badge-pulse\">\n            <span></span> FHE Encrypted\n          </span>\n          <span className=\"badge-decoration badge-decoration-success\">\n            <span></span> Privacy First\n          </span>\n          <span className=\"badge-decoration\">\n            <span></span> On-Chain Verification\n          </span>\n        </div>\n      </div>\n\n      {/* Age Input Section */}\n      <div className=\"panel-card\">\n        <div className=\"panel-shimmer\"></div>\n        <h2 className=\"panel-title mb-6\">Enter Your Age</h2>\n        <div className=\"form-group mb-4\">\n          <div className=\"flex gap-4\">\n            <input\n              type=\"number\"\n              value={age}\n              onChange={(e) => setAge(e.target.value)}\n              placeholder=\"Enter your age (e.g., 18)\"\n              className=\"flex-1\"\n              min=\"0\"\n              max=\"120\"\n            />\n            <button\n              onClick={handleSubmitAge}\n              disabled={!age || isSubmitting || isWritePending || isConfirming || !fhevmInstance}\n              className={`btn btn-primary min-w-[140px] ${(isSubmitting || isWritePending || isConfirming) ? 'btn-loading' : ''}`}\n              title={\n                !age\n                  ? \"Please enter your age\"\n                  : !fhevmInstance\n                  ? \"FHEVM is initializing, please wait...\"\n                  : isWritePending\n                  ? \"Waiting for wallet confirmation...\"\n                  : isConfirming\n                  ? \"Transaction is confirming...\"\n                  : isSubmitting\n                  ? \"Submitting...\"\n                  : \"Click to submit your encrypted age\"\n              }\n            >\n              {isSubmitting || isWritePending || isConfirming ? \"Processing...\" : \"Submit Age\"}\n            </button>\n          </div>\n        </div>\n        \n        {!age && (\n          <p className=\"text-sm text-[var(--text-muted)] mt-2\">Please enter your age above</p>\n        )}\n        {age && !fhevmInstance && (\n          <div className=\"mt-4 p-3 rounded-lg bg-gradient-to-r from-[rgba(245,158,11,0.1)] to-[rgba(245,158,11,0.05)] border border-[rgba(245,158,11,0.2)]\">\n            <p className=\"text-sm text-[var(--warning)] font-medium\">\n              FHEVM is initializing... Please wait a moment before submitting.\n            </p>\n          </div>\n        )}\n        {fhevmInstance && fhevmStatus !== \"ready\" && (\n          <div className=\"mt-4 p-3 rounded-lg bg-gradient-to-r from-[rgba(245,158,11,0.1)] to-[rgba(245,158,11,0.05)] border border-[rgba(245,158,11,0.2)]\">\n            <p className=\"text-sm text-[var(--warning)] font-medium\">\n               FHEVM status: {fhevmStatus}. You can try submitting, but it may fail if not ready.\n            </p>\n          </div>\n        )}\n        {fhevmError && (\n          <div className=\"mt-4 p-3 rounded-lg bg-gradient-to-r from-[rgba(239,68,68,0.1)] to-[rgba(239,68,68,0.05)] border border-[rgba(239,68,68,0.2)]\">\n            <p className=\"text-sm text-[var(--danger)] font-medium\">FHEVM Error: {fhevmError.message}</p>\n          </div>\n        )}\n        \n        {/* Decorative divider */}\n        <div className=\"divider-decoration\">\n          <div className=\"divider-line\"></div>\n          <span className=\"divider-icon\"></span>\n          <div className=\"divider-line\"></div>\n        </div>\n        \n        {/* Decorative info */}\n        <div className=\"info-card-decoration\">\n          <p className=\"text-sm text-[var(--text-secondary)]\">\n            Your age is encrypted locally before being sent to the blockchain. The smart contract verifies eligibility without ever seeing your actual age.\n          </p>\n        </div>\n      </div>\n\n      {/* Eligibility Result Section */}\n      <div className=\"panel-card\">\n        <div className=\"panel-shimmer\"></div>\n        <h2 className=\"panel-title mb-6\">Eligibility Result</h2>\n        \n        {/* Diagnostic info for debugging */}\n        <div className=\"mb-6 p-4 rounded-lg bg-[rgba(0,0,0,0.2)] border border-[rgba(255,255,255,0.1)] text-xs font-mono space-y-2\">\n          <p className=\"text-[var(--text-muted)] uppercase tracking-wider font-bold mb-2\">Diagnostic Info</p>\n          <div className=\"flex justify-between\">\n            <span className=\"text-[var(--text-secondary)]\">Network:</span>\n            <span className={chainId === 31337 ? \"text-[var(--success)]\" : \"text-[var(--danger)]\"}>\n              {chainId === 31337 ? \"Localhost (31337)\" : `Wrong Network (${chainId})`}\n            </span>\n          </div>\n          <div className=\"flex justify-between\">\n            <span className=\"text-[var(--text-secondary)]\">Contract:</span>\n            <span className=\"text-[var(--accent)]\">{CONTRACT_ADDRESS.slice(0, 10)}...{CONTRACT_ADDRESS.slice(-8)}</span>\n          </div>\n          <div className=\"flex justify-between\">\n            <span className=\"text-[var(--text-secondary)]\">Wallet:</span>\n            <span className=\"text-[var(--text-primary)]\">{address?.slice(0, 10)}...{address?.slice(-8)}</span>\n          </div>\n          <div className=\"flex justify-between items-center pt-2 border-t border-[rgba(255,255,255,0.05)]\">\n            <span className=\"text-[var(--text-secondary)]\">Raw Handle:</span>\n            <span className=\"text-[var(--accent)] truncate max-w-[200px]\" title={eligibilityHandle as string}>\n              {eligibilityHandle ? (eligibilityHandle as string) : \"null/undefined\"}\n            </span>\n          </div>\n        </div>\n        \n        <div className=\"mb-4 p-3 rounded-lg bg-gradient-to-r from-[rgba(99,102,241,0.05)] to-[rgba(99,102,241,0.02)] border border-[rgba(99,102,241,0.15)]\">\n          <p className=\"text-xs font-mono text-[var(--text-secondary)] mb-1\">Encrypted Result Handle</p>\n          <p className=\"text-sm font-mono text-[var(--accent)] break-all\">\n            {eligibilityHandle && eligibilityHandle !== \"0x0000000000000000000000000000000000000000000000000000000000000000\" \n              ? `${(eligibilityHandle as string).slice(0, 20)}...${(eligibilityHandle as string).slice(-10)}`\n              : \"No handle found (Waiting for transaction or wrong contract)\"}\n          </p>\n          <button \n            onClick={() => refetchEligibility()} \n            className=\"mt-2 text-xs text-[var(--accent)] underline cursor-pointer bg-transparent border-none p-0\"\n          >\n            Refresh Handle From Chain\n          </button>\n        </div>\n\n        {eligibilityHandle && eligibilityHandle !== \"0x0000000000000000000000000000000000000000000000000000000000000000\" ? (\n          <>\n            <button\n              onClick={handleDecrypt}\n              disabled={isDecrypting || !fhevmInstance}\n              className={`btn btn-success w-full ${isDecrypting ? 'btn-loading' : ''}`}\n            >\n              {isDecrypting ? \"Decrypting...\" : decryptedResult !== null ? \"Decrypt Again\" : \"Decrypt Result\"}\n            </button>\n\n            {decryptedResult !== null && (\n              <div className={`mt-6 p-6 rounded-xl ${decryptedResult ? \"result-card result-eligible\" : \"result-card result-not-eligible\"}`}>\n                <div className=\"text-4xl mb-3 result-icon\">\n                  {decryptedResult ? \"\" : \"\"}\n                </div>\n                <p className={`text-2xl font-bold mb-3 ${decryptedResult ? \"text-[var(--success)]\" : \"text-[var(--danger)]\"}`}>\n                  {decryptedResult ? \"Eligible\" : \"Not Eligible\"}\n                </p>\n                <p className=\"text-base text-[var(--text-secondary)]\">\n                  {decryptedResult\n                    ? \"You meet the inheritance requirement (age 18 or older)\"\n                    : \"You do not meet the requirement (must be 18 or older)\"}\n                </p>\n              </div>\n            )}\n          </>\n        ) : (\n          <p className=\"text-sm text-[var(--warning)] text-center py-2\">\n            Result handle is zero or missing. Please submit your age first or refresh.\n          </p>\n        )}\n      </div>\n\n      {/* Message Box */}\n      {message && (\n        <div className=\"message-box\">\n          <p className=\"text-[var(--text-primary)] font-medium\">{message}</p>\n        </div>\n      )}\n      \n      {/* Decorative stats at bottom */}\n      <div className=\"stats-decoration\">\n        <div className=\"stat-item\">\n          <div className=\"stat-value\">100%</div>\n          <div className=\"stat-label\">Private</div>\n        </div>\n        <div className=\"stat-item\">\n          <div className=\"stat-value\">FHE</div>\n          <div className=\"stat-label\">Encrypted</div>\n        </div>\n        <div className=\"stat-item\">\n          <div className=\"stat-value\">18+</div>\n          <div className=\"stat-label\">Requirement</div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n"],"names":[],"mappings":"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","debugId":null}}]
}